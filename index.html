<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Recession Risk Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .last-updated {
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.8;
            font-style: italic;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .risk-meter-section {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(to bottom, #f8f9fa, white);
            margin-bottom: 30px;
            border-radius: 15px;
        }
        
        .risk-percentage {
            font-size: 5em;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .risk-label {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .risk-description {
            font-size: 1.1em;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .legend-text {
            font-weight: 600;
        }
        
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .indicator-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #ccc;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .indicator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }
        
        .indicator-card.safe {
            border-left-color: #27ae60;
        }
        
        .indicator-card.warning {
            border-left-color: #f39c12;
        }
        
        .indicator-card.critical {
            border-left-color: #e74c3c;
        }
        
        .indicator-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .indicator-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .indicator-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }
        
        .indicator-description {
            font-size: 0.85em;
            color: #777;
            margin-top: 10px;
            font-style: italic;
        }
        
        .chart-container {
            margin: 40px 0;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .chart-subtitle {
            font-size: 1em;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .chart-note {
            font-size: 0.9em;
            color: #777;
            margin-top: 15px;
            text-align: center;
            font-style: italic;
        }
        
        .historical-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-top: 40px;
        }
        
        .historical-section h3 {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .recession-markers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .recession-marker {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .recession-marker h4 {
            color: #e74c3c;
            margin-bottom: 10px;
        }
        
        .recession-marker p {
            margin: 5px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä U.S. Recession Risk Dashboard</h1>
            <div class="subtitle">Real-time Economic Indicators & Risk Assessment</div>
            <div class="last-updated" id="lastUpdated">
                Last Updated: November 20, 2025 at 02:30 PM ET
            </div>
        </header>
        
        <div class="main-content">
            <!-- Risk Meter -->
            <div class="risk-meter-section">
                <div class="risk-label" id="riskLabel">Current Recession Risk</div>
                <div class="risk-percentage" id="riskValue">20%</div>
                <div class="risk-description" id="riskDescription">
                    Economy showing healthy growth with minimal recession indicators
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #27ae60;"></div>
                        <div>
                            <div class="legend-text" style="color: #27ae60;">Low Risk (0-30%)</div>
                            <div style="font-size: 0.85em; color: #666;">Economy showing healthy growth</div>
                        </div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f39c12;"></div>
                        <div>
                            <div class="legend-text" style="color: #f39c12;">Medium Risk (31-60%)</div>
                            <div style="font-size: 0.85em; color: #666;">Warning signs emerging</div>
                        </div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <div>
                            <div class="legend-text" style="color: #e74c3c;">High Risk (61-100%)</div>
                            <div style="font-size: 0.85em; color: #666;">Recession likely or imminent</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Economic Indicators Grid -->
            <h2 style="margin-top: 40px; margin-bottom: 20px; font-size: 2em; color: #2c3e50;">Key Economic Indicators</h2>
            <div class="indicators-grid" id="indicators">
                <!-- Indicator 1: Yield Curve -->
                <div class="indicator-card" data-indicator-id="yield_curve">
                    <div class="indicator-name">Yield Curve (10Y-2Y)</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Daily ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        Difference between 10-year and 2-year Treasury yields. Inversion (negative values)
                        historically precedes recessions by 12‚Äì18 months.
                    </div>
                </div>
                
                <!-- Indicator 2: Unemployment Rate -->
                <div class="indicator-card" data-indicator-id="unemployment">
                    <div class="indicator-name">Unemployment Rate</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Monthly ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        Percentage of workforce actively seeking employment. Rapid increases of 0.5% or more
                        within 3 months often signal accelerating recession risk.
                    </div>
                </div>
                
                <!-- Indicator 3: Initial Jobless Claims -->
                <div class="indicator-card" data-indicator-id="initial_claims">
                    <div class="indicator-name">Initial Jobless Claims</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Weekly ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        Weekly new unemployment filings. Sustained increases above 300,000 typically indicate
                        labor market deterioration and rising recession risk.
                    </div>
                </div>
                
                <!-- Indicator 4: GDP Growth -->
                <div class="indicator-card" data-indicator-id="gdp_growth">
                    <div class="indicator-name">Real GDP Growth</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Quarterly ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        Inflation-adjusted economic growth rate. Two consecutive negative quarters historically
                        define recessions, though NBER uses broader criteria.
                    </div>
                </div>
                
                <!-- Indicator 5: Industrial Production -->
                <div class="indicator-card" data-indicator-id="industrial_production">
                    <div class="indicator-name">Industrial Production</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Monthly ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        Index of output for manufacturing, mining, and utilities. Persistent declines reflect
                        weakening real economic activity and are common pre-recession.
                    </div>
                </div>
                
                <!-- Indicator 6: Consumer Sentiment -->
                <div class="indicator-card" data-indicator-id="consumer_sentiment">
                    <div class="indicator-name">Consumer Sentiment</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Monthly ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        UMich survey measuring consumer expectations. Sharp declines often precede reductions
                        in spending and rising recession probability.
                    </div>
                </div>

                
                <!-- Indicator 7: Credit Spread -->
                <div class="indicator-card" data-indicator-id="bbb_credit_spread">
                    <div class="indicator-name">BBB Credit Spread</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Daily ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        Yield spread between BBB-rated corporate bonds and Treasuries. Widening spreads
                        indicate rising credit risk and financial stress.
                    </div>
                </div>

                
                <!-- Indicator 8: Housing Starts -->
                <div class="indicator-card" data-indicator-id="housing_starts">
                    <div class="indicator-name">Housing Starts</div>
                    <div class="indicator-value">‚Äî</div>
                
                    <div class="indicator-details">
                        <div>Status: ‚Äî</div>
                    </div>
                
                    <div class="js-indicator-meta">
                        Update Frequency: Monthly ‚Ä¢ Last Updated: ‚Äî
                    </div>
                
                    <div class="indicator-description">
                        Number of new residential construction projects started. Major slowdowns frequently
                        signal weakening demand and recession conditions.
                    </div>
                </div>

            </div>

            <!-- Risk Methodology Section -->
            <div class="historical-section" style="margin-top: 40px;">
                <h3>üßÆ How the Recession Risk Score Is Calculated</h3>
            
                <p>
                    The recession risk score is an additive model based on eight major U.S. economic indicators.
                    Each indicator contributes positively or negatively to the total score depending on whether
                    conditions are historically associated with expansion or recession. The score ranges from
                    <strong>5% (very low risk)</strong> to <strong>95% (very high risk)</strong>.
                </p>
            
                <h4 style="margin-top: 20px;">1. Baseline Risk</h4>
                <p>The model begins with a <strong>baseline of 15%</strong>.</p>
            
                <h4 style="margin-top: 20px;">2. Yield Curve (10Y‚Äì2Y Spread) ‚Äî Weight: 25%</h4>
                <ul>
                    <li>If spread &lt; ‚Äì0.5% ‚Üí <strong>+25 points</strong></li>
                    <li>If spread is between 0% and ‚Äì0.5% ‚Üí <strong>+ (abs(spread) ¬∑ 30)</strong></li>
                    <li>If spread &gt; 0.5% ‚Üí <strong>‚Äì5 points</strong> (normal steep curve)</li>
                </ul>
            
                <h4 style="margin-top: 20px;">3. Unemployment Rate ‚Äî Weight: 20%</h4>
                <ul>
                    <li>If unemployment &gt; 5.0% ‚Üí <strong>+ (unemployment ‚Äì 5.0) ¬∑ 8</strong></li>
                    <li>If unemployment &lt; 4.0% ‚Üí <strong>‚Äì3 points</strong> (very strong labor market)</li>
                </ul>
            
                <h4 style="margin-top: 20px;">4. Initial Jobless Claims ‚Äî Weight: 10%</h4>
                <ul>
                    <li>If claims &gt; 300,000 ‚Üí <strong>+ ((claims ‚Äì 300,000) / 10,000)</strong></li>
                </ul>
            
                <h4 style="margin-top: 20px;">5. Real GDP Growth ‚Äî Weight: 15%</h4>
                <ul>
                    <li>If GDP &lt; 0 ‚Üí <strong>+15 points</strong></li>
                    <li>If GDP is between 0% and 2% ‚Üí <strong>+ (2.0 ‚Äì GDP) ¬∑ 5</strong></li>
                </ul>
            
                <h4 style="margin-top: 20px;">6. Consumer Sentiment (UMich) ‚Äî Weight: 10%</h4>
                <ul>
                    <li>If sentiment &lt; 70 ‚Üí <strong>+10 points</strong></li>
                    <li>If sentiment is between 70 and 90 ‚Üí <strong>+ ((90 ‚Äì sentiment) / 4)</strong></li>
                </ul>
            
                <h4 style="margin-top: 20px;">7. BBB Credit Spread ‚Äî Weight: 10%</h4>
                <ul>
                    <li>If spread &gt; 2.5% ‚Üí <strong>+ (spread ‚Äì 2.5) ¬∑ 8</strong></li>
                </ul>
            
                <h4 style="margin-top: 20px;">8. Housing Starts ‚Äî Informational</h4>
                <p>
                    Housing Starts are displayed and tracked but currently do not add or subtract from the numerical score.
                </p>
            
                <h4 style="margin-top: 20px;">9. Final Score Clamping</h4>
                <p>
                    After all adjustments, the score is limited to the range:
                    <strong>5% ‚â§ risk ‚â§ 95%</strong>.
                </p>
            
                <h4 style="margin-top: 20px;">10. Daily Updates</h4>
                <p>
                    All indicator updates and risk recalculations occur automatically via scheduled GitHub Actions
                    using data from the Federal Reserve Economic Data (FRED) API.
                </p>
            </div>

            
            <!-- Historical Context -->
            <div class="historical-section">
                <h3>üìú Historical Recession Comparison</h3>
                <p>The chart below shows current risk trends compared to past recessions. Gray shaded areas indicate official NBER recession periods. Notice how risk typically spikes 6-18 months before recessions begin.</p>
                
                <div class="recession-markers">
                    <div class="recession-marker">
                        <h4>2020 COVID Recession</h4>
                        <p><strong>Feb-Apr 2020</strong></p>
                        <p>Peak Risk: 95% | Duration: 2 months</p>
                        <p>Fastest indicators: Jobless claims (+3000%), ISM (-20 points)</p>
                    </div>
                    <div class="recession-marker">
                        <h4>2008 Financial Crisis</h4>
                        <p><strong>Dec 2007-Jun 2009</strong></p>
                        <p>Peak Risk: 88% | Duration: 18 months</p>
                        <p>Leading indicators: Yield curve inverted 22 months prior</p>
                    </div>
                    <div class="recession-marker">
                        <h4>2001 Dot-Com Bust</h4>
                        <p><strong>Mar-Nov 2001</strong></p>
                        <p>Peak Risk: 72% | Duration: 8 months</p>
                        <p>Warnings: LEI declined 12 months before</p>
                    </div>
                    <div class="recession-marker">
                        <h4>1990-91 Recession</h4>
                        <p><strong>Jul 1990-Mar 1991</strong></p>
                        <p>Peak Risk: 68% | Duration: 8 months</p>
                        <p>Triggers: Oil shock, yield curve inversion</p>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Recession Risk Trend (Past 2 Years)</div>
                <div class="chart-subtitle">
                    Green zone: Low risk (0-30%) ‚Ä¢ Yellow zone: Medium risk (31-60%) ‚Ä¢ Red zone: High risk (61-100%)
                </div>
                <div class="chart-wrapper">
                    <canvas id="riskChart"></canvas>
                </div>
                <div class="chart-note">
                    üìä Chart displays real-time risk data from FRED economic indicators.
                </div>
            </div>
        </div>
    </div>
    
        <script>
        // --------- Helper: risk tier label & description ----------
        function getRiskTier(risk) {
            if (risk == null || isNaN(risk)) {
                return {
                    label: 'Recession Risk (Unavailable)',
                    description: 'Risk cannot be computed because one or more indicators are missing.'
                };
            }
    
            if (risk < 30) {
                return {
                    label: 'Low Recession Risk',
                    description: 'Economy showing healthy growth with minimal recession indicators.'
                };
            } else if (risk < 60) {
                return {
                    label: 'Medium Recession Risk',
                    description: 'Some early warning signs are emerging‚Äîconditions bear watching.'
                };
            } else {
                return {
                    label: 'High Recession Risk',
                    description: 'Multiple indicators point to elevated recession risk in the near term.'
                };
            }
        }
    
        // --------- Helper: format indicator values ----------
        function formatIndicatorValue(id, value) {
            if (value == null || isNaN(value)) return '‚Äî';
            value = Number(value);
    
            switch (id) {
                case 'yield_curve':
                    return (value >= 0 ? '+' : '') + value.toFixed(2) + '%';
                case 'unemployment':
                    return value.toFixed(1) + '%';
                case 'initial_claims':
                    return Math.round(value).toLocaleString('en-US');
                case 'gdp_growth':
                    return value.toFixed(1) + '%';
                case 'industrial_production':
                    return value.toFixed(1);
                case 'consumer_sentiment':
                    return value.toFixed(1);
                case 'bbb_credit_spread':
                    return value.toFixed(2) + '%';
                case 'housing_starts':
                    return value.toFixed(1) + 'K';
                default:
                    return String(value);
            }
        }
    
        // --------- Helper: compute indicator status (Safe / Warning / Critical) ----------
        function getIndicatorStatus(id, value) {
            if (value == null || isNaN(value)) {
                return { label: 'Status: ‚Äî', className: '' };
            }
            value = Number(value);
    
            // Simple, explainable heuristics (you can tune these)
            switch (id) {
                case 'yield_curve':
                    if (value < 0) return { label: 'Status: ‚ö†Ô∏è Inverted (Warning)', className: 'warning' };
                    if (value < 0.5) return { label: 'Status: ‚ö†Ô∏è Flattened', className: 'warning' };
                    return { label: 'Status: ‚úÖ Normal', className: 'safe' };
    
                case 'unemployment':
                    if (value >= 6.0) return { label: 'Status: üî¥ Elevated', className: 'critical' };
                    if (value >= 4.5) return { label: 'Status: ‚ö†Ô∏è Rising', className: 'warning' };
                    return { label: 'Status: ‚úÖ Healthy', className: 'safe' };
    
                case 'initial_claims':
                    if (value >= 300000) return { label: 'Status: üî¥ High claims', className: 'critical' };
                    if (value >= 250000) return { label: 'Status: ‚ö†Ô∏è Elevated claims', className: 'warning' };
                    return { label: 'Status: ‚úÖ Normal range', className: 'safe' };
    
                case 'gdp_growth':
                    if (value < 0) return { label: 'Status: üî¥ Contraction', className: 'critical' };
                    if (value < 2.0) return { label: 'Status: ‚ö†Ô∏è Slowing growth', className: 'warning' };
                    return { label: 'Status: ‚úÖ Solid growth', className: 'safe' };
    
                case 'industrial_production':
                    // Harder without YoY change; treat any value as neutral for now
                    return { label: 'Status: ‚ÑπÔ∏è Monitor trend', className: '' };
    
                case 'consumer_sentiment':
                    if (value < 60) return { label: 'Status: üî¥ Very weak sentiment', className: 'critical' };
                    if (value < 80) return { label: 'Status: ‚ö†Ô∏è Below average', className: 'warning' };
                    return { label: 'Status: ‚úÖ Normal/strong', className: 'safe' };
    
                case 'bbb_credit_spread':
                    if (value >= 3.5) return { label: 'Status: üî¥ High stress', className: 'critical' };
                    if (value >= 2.5) return { label: 'Status: ‚ö†Ô∏è Elevated stress', className: 'warning' };
                    return { label: 'Status: ‚úÖ Stable credit', className: 'safe' };
    
                case 'housing_starts':
                    // Without trend, just show neutral label
                    return { label: 'Status: ‚ÑπÔ∏è Monitor trend', className: '' };
    
                default:
                    return { label: 'Status: ‚Äî', className: '' };
            }
        }
    
        // --------- Update header (risk meter + last updated) ----------
        function updateHeader(riskValue, riskDate, generatedAt) {
            const riskLabelEl = document.getElementById('riskLabel');
            const riskValueEl = document.getElementById('riskValue');
            const riskDescriptionEl = document.getElementById('riskDescription');
            const lastUpdatedEl = document.getElementById('lastUpdated');
    
            if (riskValueEl && riskValue != null && !isNaN(riskValue)) {
                riskValueEl.textContent = Number(riskValue).toFixed(1) + '%';
            }
    
            const tier = getRiskTier(riskValue);
            if (riskLabelEl) riskLabelEl.textContent = tier.label;
            if (riskDescriptionEl) riskDescriptionEl.textContent = tier.description;
    
            let displayText = 'Last Updated: ';
    
            if (generatedAt) {
                const d = new Date(generatedAt);
                if (!isNaN(d)) {
                    const dateStr = d.toLocaleString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    });
                    displayText += dateStr + ' ET (latest model run)';
                } else {
                    displayText += generatedAt;
                }
            } else if (riskDate) {
                const d = new Date(riskDate);
                const dateStr = isNaN(d)
                    ? riskDate
                    : d.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                displayText += dateStr + ' (latest available data)';
            } else {
                displayText += 'N/A';
            }
    
            if (lastUpdatedEl) lastUpdatedEl.textContent = displayText;
        }
    
        // --------- Update indicator tiles ----------
        function updateIndicatorCards(indicators) {
            if (!Array.isArray(indicators)) return;
            const map = new Map(indicators.map(i => [i.id, i]));
    
            document.querySelectorAll('.indicator-card[data-indicator-id]').forEach(card => {
                const id = card.dataset.indicatorId;
                const data = map.get(id);
                if (!data) return;
    
                // Value
                const valueEl = card.querySelector('.indicator-value');
                if (valueEl) {
                    valueEl.textContent = formatIndicatorValue(id, data.value);
                }
    
                // Meta line: frequency + last updated
                const metaEl = card.querySelector('.js-indicator-meta');
                if (metaEl) {
                    const freq = data.frequency || 'Unknown frequency';
                    const last = data.last_updated || 'N/A';
                    metaEl.textContent = `${freq} ‚Ä¢ Last Updated: ${last}`;
                }
    
                // Status line (first div inside .indicator-details)
                const statusInfo = getIndicatorStatus(id, data.value);
                const statusContainer = card.querySelector('.indicator-details div');
                if (statusContainer) {
                    statusContainer.textContent = statusInfo.label;
                }
    
                // Card border color (safe/warning/critical)
                card.classList.remove('safe', 'warning', 'critical');
                if (statusInfo.className) {
                    card.classList.add(statusInfo.className);
                }
            });
        }
    
        // --------- Create risk chart ----------
        function createRiskChart(history) {
            if (!history || history.length === 0) {
                console.error('No history data for chart');
                return;
            }
    
            const ctx = document.getElementById('riskChart');
            if (!ctx) {
                console.error('Canvas element not found');
                return;
            }
    
            const labels = history.map(d => d.date);
            const data = history.map(d => d.risk);
    
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Recession Risk %',
                        data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#3498db',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        // Color each segment based on risk value at the start of the segment
                        segment: {
                            borderColor: ctx => {
                                const v = ctx.p0.parsed.y;
                                if (v < 30) return '#27ae60';   // green
                                if (v < 60) return '#f39c12';   // yellow
                                return '#e74c3c';               // red
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            cornerRadius: 6,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            callbacks: {
                                label: function(context) {
                                    return 'Risk: ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                lowRisk: {
                                    type: 'box',
                                    yMin: 0,
                                    yMax: 30,
                                    backgroundColor: 'rgba(39, 174, 96, 0.08)',
                                    borderWidth: 0
                                },
                                mediumRisk: {
                                    type: 'box',
                                    yMin: 30,
                                    yMax: 60,
                                    backgroundColor: 'rgba(243, 156, 18, 0.08)',
                                    borderWidth: 0
                                },
                                highRisk: {
                                    type: 'box',
                                    yMin: 60,
                                    yMax: 100,
                                    backgroundColor: 'rgba(231, 76, 60, 0.08)',
                                    borderWidth: 0
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Date',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                maxTicksLimit: 12,
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Recession Risk %',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            },
                            min: 0,
                            max: 100,
                            ticks: {
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }
    
        // --------- Main loader: fetch JSON + wire everything ----------
        async function loadDashboardData() {
            try {
                console.log('Fetching risk_history.json and current_indicators.json...');
                const [historyRes, indicatorsRes] = await Promise.all([
                    fetch('risk_history.json'),
                    fetch('current_indicators.json')
                ]);
    
                if (!historyRes.ok) throw new Error('Failed to load risk_history.json');
                if (!indicatorsRes.ok) throw new Error('Failed to load current_indicators.json');
    
                const history = await historyRes.json();
                const indicatorsData = await indicatorsRes.json();
    
                const riskValue =
                    indicatorsData?.risk?.value ??
                    (history.length ? history[history.length - 1].risk : null);
    
                const riskDate =
                    indicatorsData?.risk?.date ??
                    (history.length ? history[history.length - 1].date : null);
    
                const generatedAt = indicatorsData?.generated_at ?? null;
    
                updateHeader(riskValue, riskDate, generatedAt);
                updateIndicatorCards(indicatorsData.indicators || []);
                createRiskChart(history);
    
                console.log('‚úÖ Dashboard data loaded successfully');
            } catch (error) {
                console.error('‚ùå Error loading dashboard data:', error);
            }
        }
    
        window.addEventListener('load', loadDashboardData);
    </script>

</body>
</html>
